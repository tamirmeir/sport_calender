<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Test Page</title>
    <link rel="stylesheet" href="/css_v2/styles.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 20px;
            background-color: #f8fafc;
        }
        .test-section { 
            margin: 30px 0; 
            padding: 20px; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 { 
            margin-top: 0; 
            color: #334155;
        }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .finished-card {
            border: 2px solid #d4af37 !important;
            background: linear-gradient(135deg, #fffdf7 0%, #f9f6e8 100%) !important;
        }
        .grid-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            background: white;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .grid-card img {
            width: 48px;
            height: 48px;
            object-fit: contain;
            margin-bottom: 8px;
        }
        .league-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: #334155;
            display: block;
            margin-bottom: 4px;
        }
        .console-log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <h1>üèÜ Tournament System Test Page</h1>
    
    <div class="test-section">
        <h2>üì° Backend Data Test</h2>
        <button onclick="testBackendData()">Load Tournament Data from Backend</button>
        <div id="backend-status" style="margin-top: 10px;"></div>
        <div id="console-backend" class="console-log" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>üé® Golden Cards Test</h2>
        <button onclick="showGoldenCards()">Show Finished Tournaments (Golden Cards)</button>
        <div id="golden-cards-container" class="cards-grid"></div>
        <div id="console-golden" class="console-log" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Spain Leagues Test</h2>
        <button onclick="testSpainLeagues()">Load Spain Leagues (Should show Supercopa as Golden)</button>
        <div id="spain-leagues-container" class="cards-grid"></div>
        <div id="console-spain" class="console-log" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = '/api/fixtures';
        
        function log(containerId, message) {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            container.innerHTML += `${new Date().toLocaleTimeString()}: ${message}<br>`;
            container.scrollTop = container.scrollHeight;
        }
        
        async function testBackendData() {
            try {
                log('console-backend', 'Loading tournament data from backend...');
                const response = await fetch(`${API_BASE}/tournaments/status/all`);
                const data = await response.json();
                
                log('console-backend', `‚úÖ Loaded ${Object.keys(data.tournaments).length} tournaments`);
                log('console-backend', `üìÖ Current month: ${data.month}`);
                
                // Show some examples
                const finished = Object.entries(data.tournaments).filter(([id, t]) => t.status === 'finished' && t.winner);
                log('console-backend', `üèÜ Finished tournaments with winners: ${finished.length}`);
                
                finished.slice(0, 3).forEach(([id, tournament]) => {
                    log('console-backend', `  - ID ${id}: ${tournament.winner.name}`);
                });
                
                document.getElementById('backend-status').innerHTML = 
                    `<strong>‚úÖ Success!</strong> Loaded ${Object.keys(data.tournaments).length} tournaments`;
                
            } catch (error) {
                log('console-backend', `‚ùå Error: ${error.message}`);
                document.getElementById('backend-status').innerHTML = 
                    `<strong>‚ùå Error:</strong> ${error.message}`;
            }
        }
        
        async function showGoldenCards() {
            try {
                log('console-golden', 'Loading tournament data...');
                const response = await fetch(`${API_BASE}/tournaments/status/all`);
                const data = await response.json();
                
                const container = document.getElementById('golden-cards-container');
                container.innerHTML = '';
                
                const finishedTournaments = Object.entries(data.tournaments)
                    .filter(([id, tournament]) => tournament.status === 'finished' && tournament.winner);
                
                log('console-golden', `Creating ${finishedTournaments.length} golden cards...`);
                
                finishedTournaments.forEach(([id, tournament]) => {
                    const card = document.createElement('div');
                    card.className = 'grid-card finished-card';
                    card.style.position = 'relative';
                    
                    const winnerDisplay = tournament.winner ? 
                        `<div style="display:flex;align-items:center;gap:8px;margin-top:8px;padding:8px;background:rgba(255,255,255,0.6);border-radius:6px;">
                            <img src="${tournament.winner.logo}" alt="${tournament.winner.name}" style="width:24px;height:24px;object-fit:contain;" onerror="this.style.display='none'">
                            <div style="flex:1;">
                                <div style="font-size:0.7rem;color:#8b6914;font-weight:600;">WINNER</div>
                                <div style="font-size:0.85rem;color:#6b5416;font-weight:700;">${tournament.winner.name}</div>
                            </div>
                        </div>` : '';
                    
                    card.innerHTML = `
                        <div style="position:absolute;top:8px;right:8px;font-size:1.5rem;">üèÜ</div>
                        <span class="league-name">Tournament ID: ${id}</span>
                        <div style="margin-top:12px;padding:10px 14px;background:rgba(212,175,55,0.15);border-radius:8px;border:1px dashed #d4af37;">
                            <div style="font-size:0.9rem;color:#8b6914;font-weight:700;letter-spacing:0.5px;">TOURNAMENT</div>
                            <div style="font-size:0.85rem;color:#6b5416;margin-top:2px;">Completed</div>
                        </div>
                        ${winnerDisplay}
                    `;
                    
                    container.appendChild(card);
                    log('console-golden', `‚ú® Created golden card for tournament ${id}: ${tournament.winner?.name || 'No winner'}`);
                });
                
            } catch (error) {
                log('console-golden', `‚ùå Error: ${error.message}`);
            }
        }
        
        async function testSpainLeagues() {
            try {
                log('console-spain', 'Loading Spain leagues...');
                const leaguesResponse = await fetch(`${API_BASE}/leagues?country=Spain`);
                const leagues = await leaguesResponse.json();
                
                log('console-spain', `üì• Loaded ${leagues.length} Spain leagues`);
                
                log('console-spain', 'Loading tournament data...');
                const tournamentResponse = await fetch(`${API_BASE}/tournaments/status/all`);
                const tournamentData = await tournamentResponse.json();
                
                const container = document.getElementById('spain-leagues-container');
                container.innerHTML = '';
                
                leagues.forEach(league => {
                    const tournamentInfo = tournamentData.tournaments[league.id];
                    const isFinished = tournamentInfo && tournamentInfo.status === 'finished' && tournamentInfo.winner;
                    
                    const card = document.createElement('div');
                    card.className = isFinished ? 'grid-card finished-card' : 'grid-card';
                    
                    if (isFinished) {
                        log('console-spain', `üéä Found finished tournament: ${league.name} (ID: ${league.id}) - Winner: ${tournamentInfo.winner.name}`);
                        
                        const winnerDisplay = `
                            <div style="display:flex;align-items:center;gap:8px;margin-top:8px;padding:8px;background:rgba(255,255,255,0.6);border-radius:6px;">
                                <img src="${tournamentInfo.winner.logo}" alt="${tournamentInfo.winner.name}" style="width:24px;height:24px;object-fit:contain;" onerror="this.style.display='none'">
                                <div style="flex:1;">
                                    <div style="font-size:0.7rem;color:#8b6914;font-weight:600;">WINNER</div>
                                    <div style="font-size:0.85rem;color:#6b5416;font-weight:700;">${tournamentInfo.winner.name}</div>
                                </div>
                            </div>`;
                        
                        card.innerHTML = `
                            <div style="position:absolute;top:8px;right:8px;font-size:1.5rem;">üèÜ</div>
                            <img src="${league.logo}" alt="${league.name}" onerror="this.src='/favicon.svg'">
                            <span class="league-name" style="color:#6b5416;font-weight:600;">${league.name}</span>
                            <div style="margin-top:12px;padding:10px 14px;background:rgba(212,175,55,0.15);border-radius:8px;border:1px dashed #d4af37;">
                                <div style="font-size:0.9rem;color:#8b6914;font-weight:700;letter-spacing:0.5px;">TOURNAMENT</div>
                                <div style="font-size:0.85rem;color:#6b5416;margin-top:2px;">Completed</div>
                            </div>
                            ${winnerDisplay}
                        `;
                    } else {
                        card.innerHTML = `
                            <img src="${league.logo}" alt="${league.name}" onerror="this.src='/favicon.svg'">
                            <span class="league-name">${league.name}</span>
                            <div style="font-size:0.8rem;color:#64748b;margin-top:4px;">${league.type || 'League'}</div>
                        `;
                        log('console-spain', `‚öΩ Regular league: ${league.name} (ID: ${league.id})`);
                    }
                    
                    container.appendChild(card);
                });
                
            } catch (error) {
                log('console-spain', `‚ùå Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>